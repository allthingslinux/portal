name: Maintenance

on:
  push:
    branches: [main]
  workflow_dispatch:
    inputs:
      manual_commit_ref:
        description: SHA to compare for TODOs (optional)
        required: false
      manual_base_ref:
        description: Base SHA for TODO comparison (optional)
        required: false

concurrency:
  group: ${{ github.workflow }}-${{ github.ref }}
  cancel-in-progress: false

jobs:
  todos:
    name: TODOs
    runs-on: ubuntu-latest
    timeout-minutes: 10
    permissions:
      contents: read
      issues: write
    steps:
      - name: Checkout
        uses: actions/checkout@8e8c483db84b4bee98b60c0593521ed34d9990e8 # v6
        with:
          fetch-depth: 0
      - name: Convert TODOs to issues
        uses: alstr/todo-to-issue-action@c45b007d85c8edf3365b139a9d4c65793e7c674f # v5.1.13
        with:
          CLOSE_ISSUES: true
          INSERT_ISSUE_URLS: true
          AUTO_ASSIGN: true
          # Only actionable markers; exclude NOTE to avoid issues from doc comments
          IDENTIFIERS: |
            [
              {"name": "TODO", "labels": ["todo-to-issue"]},
              {"name": "FIXME", "labels": ["todo-to-issue"]},
              {"name": "XXX", "labels": ["todo-to-issue"]},
              {"name": "HACK", "labels": ["todo-to-issue"]}
            ]
          IGNORE: |
            .github/,node_modules/,.next/,dist/,build/,coverage/,.git/,.cursor/
          ESCAPE: true
        env:
          MANUAL_COMMIT_REF: ${{ github.event.inputs.manual_commit_ref }}
          MANUAL_BASE_REF: ${{ github.event.inputs.manual_base_ref }}
